name: Story Update on Issue

on:
  issues:
    types: [opened, labeled]
  issue_comment:
    types: [created]

permissions:
  issues: write

jobs:
  trigger-claude:
    runs-on: ubuntu-latest
    # Nur triggern bei neuen Issues ODER wenn @storytime im Kommentar erwähnt wird
    if: |
      github.event_name == 'issues' ||
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@storytime'))

    steps:
      - name: Comment to trigger Claude
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            @claude Bitte lies dieses Issue und die CLAUDE.md Instruktionen.

            Entwickle die Geschichte in story.md basierend auf diesem Vorschlag weiter.

            Folge dabei strikt den Richtlinien in CLAUDE.md:
            - Lies story.md und alle relevanten Charakter-/Ortsdateien
            - Schreibe ein neues Kapitel (300-800 Wörter)
            - Erstelle/aktualisiere Charakter-, Orts- oder Item-Dateien falls nötig
            - Halte dich an den etablierten Story-Stil

            Erstelle einen Pull Request mit allen Änderungen.
